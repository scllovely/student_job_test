{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        /* 为 #container 元素添加样式，使其布局在毕业生去向数据分析可视化区域内 */
        .fater-pannel-body {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 45%;
        }

        /* 给标题添加底部外边距 */
        .fater-pannel-title {
            margin-bottom: 20px; /* 可根据需要调整间距大小 */
        }
    </style>
</head>
<body>
   <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
   {% include 'templates/head.html' %}

<div class="fater-layout-header">
    {% include 'templates/nav.html' %}
</div>

<div class="fater-layout-menus">
    {% include 'templates/menus.html' %}
</div>
<div class="fater-layout-body">
    <div class="fater-panel">
        <div class="fater-pannel-title">毕业生去向数据分析可视化</div>
        <div class="fater-pannel-body">
            <div id="location_bar" style="width: 100%; height: 400px;"></div>
            <div id="size_pie" style="width: 100%; height: 400px;"></div>
            <div id="type_bar" style="width: 100%; height: 400px;"></div>
            <div id="position_type_pie" style="width: 100%; height: 400px;"></div>
            <div id="container"></div>
        </div>
    </div>
</div>

<div class="fater-layout-foot">
    {% include 'templates/foot.html' %}
</div>

{% include 'templates/commjs.html' %}
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
<script type="text/javascript" src="{% static 'js/comm.js' %}"></script>
<script type="text/javascript" src="{% static 'js/models.js' %}"></script>
<script type="text/javascript" src="{% static 'js/nav.js' %}"></script>

<script>
    window.onload = function() {
        var dom = document.getElementById("container");
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(dom);
        var app = {};
        var option = null;

        // 从后端获取数据
        const locationData = {{ location_data|safe }};
        const typeData = {{ type_data|safe }};
        const collegeData = {{ college_data|safe }};
        const positionData = {{ position_data|safe }};

        const locationTotal = {{ location_total }};
        const typeTotal = {{ type_total }};
        const collegeTotal = {{ college_total }};
        const positionTotal = {{ position_total }};

        option = {
            tooltip: {},
            title: [
                {
                    text: '各学院毕业人数',
                    subtext: '总计 ' + collegeTotal,
                    left: '25%',
                    top: '5%',
                    textAlign: 'center'
                },
                {
                    text: '岗位类别分布',
                    subtext: '总计 ' + positionTotal,
                    left: '75%',
                    top: '5%',
                    textAlign: 'center'
                },
                {
                    text: '公司类型分布',
                    subtext: '总计 ' + typeTotal,
                    left: '25%',
                    top: '55%',
                    textAlign: 'center'
                },
                {
                    text: '公司所在地分布',
                    subtext: '总计 ' + locationTotal,
                    left: '75%',
                    top: '55%',
                    textAlign: 'center'
                }
            ],
            grid: [
                {
                    top: '15%',
                    width: '35%',
                    bottom: '55%',
                    left: '10%',
                    containLabel: true
                },
                {
                    top: '15%',
                    width: '35%',
                    bottom: '55%',
                    left: '55%',
                    containLabel: true
                }
            ],
            xAxis: [
                {
                    type: 'value',
                    max: collegeTotal,
                    splitLine: {
                        show: false
                    },
                    gridIndex: 0
                },
                {
                    type: 'value',
                    max: positionTotal,
                    splitLine: {
                        show: false
                    },
                    gridIndex: 1
                }
            ],
            yAxis: [
                {
                    type: 'category',
                    data: collegeData.map(item => item.name),
                    axisLabel: {
                        interval: 0,
                        rotate: 30
                    },
                    splitLine: {
                        show: false
                    },
                    gridIndex: 0
                },
                {
                    type: 'category',
                    data: positionData.map(item => item.name),
                    axisLabel: {
                        interval: 0,
                        rotate: 30
                    },
                    splitLine: {
                        show: false
                    },
                    gridIndex: 1
                }
            ],
            series: [
                {
                    type: 'bar',
                    stack: 'chart',
                    z: 3,
                    label: {
                        position: 'right',
                        show: true
                    },
                    data: collegeData.map(item => item.value),
                    xAxisIndex: 0,
                    yAxisIndex: 0
                },
                {
                    type: 'bar',
                    stack: 'chart',
                    silent: true,
                    itemStyle: {
                        color: '#eee'
                    },
                    data: collegeData.map(item => collegeTotal - item.value),
                    xAxisIndex: 0,
                    yAxisIndex: 0
                },
                {
                    type: 'bar',
                    stack: 'component',
                    z: 3,
                    label: {
                        position: 'right',
                        show: true
                    },
                    data: positionData.map(item => item.value),
                    xAxisIndex: 1,
                    yAxisIndex: 1
                },
                {
                    type: 'bar',
                    stack: 'component',
                    silent: true,
                    itemStyle: {
                        color: '#eee'
                    },
                    data: positionData.map(item => positionTotal - item.value),
                    xAxisIndex: 1,
                    yAxisIndex: 1
                },
                {
                    type: 'pie',
                    radius: [0, '30%'],
                    center: ['25%', '80%'],
                    data: typeData,
                    label: {
                        show: true,
                        formatter: '{b}: {d}%'
                    }
                },
                {
                    type: 'pie',
                    radius: [0, '30%'],
                    center: ['75%', '80%'],
                    data: locationData,
                    label: {
                        show: true,
                        formatter: '{b}: {d}%'
                    }
                }
            ]
        };

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }
    };
</script>

</body>
</html>